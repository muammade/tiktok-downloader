<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>VideoSave Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #FE2C55; --secondary: #25F4EE; --bg: #0f1013; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; }
        body { background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        header { width: 100%; padding: 20px; background: #1c1e22; text-align: center; border-bottom: 2px solid var(--primary); font-weight: 900; font-size: 1.5rem; }
        .container { width: 95%; max-width: 600px; background: #1c1e22; margin-top: 30px; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; }
        .input-group { display: flex; gap: 10px; margin: 20px 0; }
        input { flex: 1; padding: 15px; border-radius: 10px; border: 1px solid #333; background: #000; color: white; outline: none; }
        button { padding: 15px 25px; border-radius: 10px; border: none; background: var(--primary); color: white; font-weight: bold; cursor: pointer; }
        #resultArea { display: none; margin-top: 25px; padding-top: 25px; border-top: 1px solid #333; }
        #vCover { width: 100%; border-radius: 15px; border: 2px solid var(--secondary); margin-bottom: 15px; }
        .dl-link { display: block; width: 100%; padding: 15px; background: var(--secondary); color: #000; text-decoration: none; font-weight: bold; border-radius: 10px; }
        .ad-box { width: 100%; min-height: 100px; background: rgba(255,255,255,0.02); margin: 20px 0; border-radius: 10px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
    </style>
</head>
<body>

    <header>VIDEOSAVE <span>PRO</span></header>

    <div class="ad-box">
        <script async="async" data-cfasync="false" src="https://pl28334678.effectivegatecpm.com/f54e9c6f51b6bf561ffbceea1f602cc5/invoke.js"></script>
        <div id="container-f54e9c6f51b6bf561ffbceea1f602cc5"></div>
    </div>

    <div class="container">
        <h2>أسرع محمل فيديوهات</h2>
        <div class="input-group">
            <input type="text" id="urlInput" placeholder="ضع الرابط هنا...">
            <button id="fetchBtn">تحميل</button>
        </div>

        <div id="resultArea">
            <img id="vCover" src="" alt="Video Preview">
            <h3 id="vTitle" style="margin-bottom: 15px;"></h3>
            <a href="#" id="dlBtn" class="dl-link">حفظ الفيديو الآن</a>
        </div>
    </div>

    <div class="ad-box" style="margin-top: 40px;">
        <div id="container-f54e9c6f51b6bf561ffbceea1f602cc5-2"></div>
    </div>

    <script>
        const fetchBtn = document.getElementById('fetchBtn');
        const urlInput = document.getElementById('urlInput');
        const resultArea = document.getElementById('resultArea');

        fetchBtn.onclick = async () => {
            const url = urlInput.value.trim();
            if (!url) return alert('أدخل الرابط!');

            fetchBtn.innerText = 'جاري المعالجة...';
            try {
                const response = await fetch(`/api/download?url=${encodeURIComponent(url)}`);
                const result = await response.json();

                if (result.code === 0) {
                    const data = result.data;
                    document.getElementById('vCover').src = data.cover;
                    document.getElementById('vTitle').innerText = data.title || "فيديو جاهز";
                    
                    // الإصلاح القاتل للرابط الخطأ:
                    const videoPath = data.hdplay || data.play;
                    const finalUrl = videoPath.startsWith('http') ? videoPath : `https://www.tikwm.com${videoPath}`;
                    
                    document.getElementById('dlBtn').onclick = (e) => {
                        e.preventDefault();
                        window.open(finalUrl, '_blank'); // سيفتح الرابط بشكل صحيح الآن
                    };
                    
                    resultArea.style.display = 'block';
                } else {
                    alert('خطأ في جلب البيانات.');
                }
            } catch (err) {
                alert('عطل في السيرفر.');
            } finally {
                fetchBtn.innerText = 'تحميل';
            }
        };
    </script>
</body>
</html>
