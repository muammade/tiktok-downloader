<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer"> <title>Ultimate Downloader HD</title>
    <style>
        :root { --p: #ff0050; --s: #00f2ea; --b: #0a0a0a; }
        body { background: var(--b); color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: #1a1a1a; padding: 30px; border-radius: 20px; width: 100%; max-width: 500px; text-align: center; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input { width: 100%; padding: 15px; border-radius: 10px; border: 1px solid #444; background: #000; color: white; margin-bottom: 20px; outline: none; }
        input:focus { border-color: var(--s); }
        button { width: 100%; padding: 15px; border-radius: 10px; border: none; background: var(--p); color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { opacity: 0.8; transform: scale(1.02); }
        #res { display: none; margin-top: 25px; animation: fadeIn 0.5s; }
        img { width: 100%; border-radius: 12px; margin-bottom: 15px; border: 2px solid var(--s); display: block; }
        .dl-btn { display: block; background: var(--s); color: black; padding: 15px; border-radius: 10px; text-decoration: none; font-weight: bold; margin-top: 10px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="card">
        <h2 style="margin-bottom: 10px; color: var(--s);">Ultimate Downloader</h2>
        <p style="font-size: 0.8rem; color: #888; margin-bottom: 20px;">يدعم تيك توك، فيسبوك، وإنستجرام</p>
        
        <input type="text" id="url" placeholder="ضع الرابط هنا...">
        <button id="btn">تحميل بأعلى جودة HD</button>

        <div id="res">
            <img id="cover" src="" alt="Video Preview">
            <p id="title" style="margin-bottom: 15px; font-weight: bold;"></p>
            <a href="#" id="link" class="dl-btn">حفظ الفيديو للجهاز</a>
        </div>
    </div>

    <script>
        document.getElementById('btn').onclick = async () => {
            const val = document.getElementById('url').value;
            if(!val) return;
            document.getElementById('btn').innerText = 'جاري المعالجة...';

            try {
                const r = await fetch(`/api/download?url=${encodeURIComponent(val)}`);
                const j = await r.json();

                if(j.code === 0) {
                    // نختار جودة HD إذا توفرت، وإلا الجودة العادية
                    const videoPath = j.data.hdplay || j.data.play;
                    
                    // تحديث العناصر
                    document.getElementById('cover').src = j.data.cover;
                    document.getElementById('title').innerText = j.data.title || "فيديو جاهز";
                    
                    document.getElementById('link').onclick = (e) => {
                        e.preventDefault();
                        // التحويل للرابط المباشر
                        window.location.href = 'https://www.tikwm.com' + videoPath;
                    };
                    
                    document.getElementById('res').style.display = 'block';
                } else {
                    alert("المعذرة، الرابط غير مدعوم أو خاص.");
                }
            } catch(e) {
                alert("خطأ في الاتصال بالسيرفر.");
            } finally {
                document.getElementById('btn').innerText = 'تحميل بأعلى جودة HD';
            }
        };
    </script>
</body>
</html>
